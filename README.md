# wzxy_SWPU
2022/9/17晚：
修复了一些bug  0.4版本某几个函数是有错误的
0.5版本应该是比较稳定的正式版。用户需要填写的info.json文件应与打卡程序放在同一目录。需要填写的信息有：账号；密码；JWSESSION;收件邮箱；打卡地点。
其中JWSESSION可留空，程序会自动获取并写入info.json中用作缓存。
最后，如果遇到账号密码正确，但是却依然提示密码错误无法打卡的情况，请手动进入我在校园小程序，修改一次密码。密码可以与原密码相同，修改后即可修复此BUG。目前不清楚引起的原因。
——————————————————————————————————————————————————————————————
2022/9/11晚：
增加了发送邮件功能。更改了一些细枝末节。现在配置文件打包为一个info.json文件。用txt文本格式打开，用户需在其中填写自己的账号 密码 JWSESSION 收件邮箱
另外可能有诸多BUG 如果有遇到 请在issues中告知。
最后：由于json格式储存中文会变成unicode格式，不方便用户直接修改，因此暂时需要各位进入源码文件中，在程序的开头去填写自己的健康打卡位置。

下一步目标暂定为测试BUG。尽量做出一个适用范围更广更稳定的正式版本。
——————————————————————————————————————————————————————————————
2022/9/10晚：
源码中涉及到的几个功能函数说明：
①：GetState()函数：用当前缓存的JWSESSION尝试获取我在校园登陆状态，若未登录则main()函数会调用login()函数更新JWSESSION

②：login()函数：调用username与password登录我在校园，以获取JWSESSION并写入到本地文件中。

③：GetId()函数：通过发送http请求，获取返回数据中的学校校区ID，为最后打卡做准备。

④：GetForm()函数：通过发送http请求，从服务器返回的数据中提取出每个打卡选项的答案并返回到main()函数的body变量中

⑥：main()函数：程序运行的主干函数，按照一定顺序与我在校园服务器交互数据并最终反馈打卡情况。

这几天尝试了推广一下适用范围，总体多写了几个函数，自动获取学校校区ID 获取健康打卡正确答案，其次将从程序运行目录下的txt文件读取账号密码来更新JWSESSION。总体效果上呈现为：（也许）适用更多学校而非SWPU单独适配；从本地文件读取账号密码，更方便；自动获取打卡答案提交 使用更简单。
不足的是：打卡内容中的location还需要各位自己填写修改。作者只有本人的一个打卡账号，不能测试更多场景，故不能保证所有用户均使用正常，也许不同的人会遇到各种奇奇怪怪的BUG。
下一步将简单地添加一个自动邮件提醒打卡情况的功能。
有任何问题或者想法可以写到issues当中，我会及时回复。
——————————————————————————————————————————————————————————————
2022/9/7凌晨：
  今天实现了自动登录获取JWSESSION功能。简而言之就是更加全面地实现了自动打卡功能，不需要各位再手动抓包，只需要在源码中填入自己的账号密码。
  使用注意事项：为了方便存储JWSESSION，我将其储存在本地的文件中。 另外，前文提到的5600001，经探索发现实际上是学校+校区ID，56是SWPU的学校ID，001是成都校区，002是南充校区，003是成都医学院，因此对于非成都校区的朋友或许需要修改一下这一部分。
  暂时就写这么多，明天我会着重维护一下更多细节。
  另外会继续研究更加通用的打卡模型，实现自动获取打卡选项，并选择安全选项。
  最后的最后，这一0.2版本只是一个半成品，可能会有很多bug，请各位遇到bug向我留言或私信反馈，毕竟我只是一个python调包师傅，水平不足还请见谅。

——————————————————————————————————————————————————————————————
我在校园每日自动健康打卡（粗略版）
使用方法：通过手机小黄鸟抓包，从抓到的header中获取JWSESSION参数内容。再将其填入源码中的JWSESSION一行。
目前尚不清楚JWSESSION的更新时效是多久， 至于为什么不用fiddler搭配PC端，是因为昨日抓包发现两个问题，一是微信小程序组件更新，导致出现fiddler抓不到小程序的包，其次是我在校园疑似修改了机制，不允许PC端使用。

tips：目前只是粗糙半成品。如果不出意外，各位抓包得到的数据中，进行提交打卡的链接url应当是：
https://gw.wozaixiaoyuan.com/health/mobile/health/save?batch=5600001
url末尾的5600001作用存疑，目前怀疑是对应健康打卡这一项的内部ID，而不是每个用户对应的ID。

小黄鸟下载地址链接：https://pan.baidu.com/s/18VEpucY-mqsReWggCfmUQQ 
提取码：6666
使用非常简单。因此就不另作说明了。
如果有其余的问题，请各位朋友留言指教 或者私聊均可， 不过目前本人尚不熟悉GitHub的相关功能...




实现原理：模拟网页HTTP协议直接调用接口进行数据交换。
源码调用两个库：post（第三方库，需要使用pip install post获取） 作用是模拟http发送post指令
              json（标准库）作用是在发送post指令的过程中将数据编码成json格式
header头的作用：定义一些属性，用于告诉浏览器具体做什么以及有什么。 例如"Content-Type":"application/json;charset=UTF-8" 指的是使用json交换数据;编码使用UTF-8标准。
在这个源码中添加header包含的各项的作用是——伪装成合法的http请求。例如"User-Agent"这一行包含的信息就有设备信息，我在校园小程序也应当是由此判断用户是PC端还是手机端。

body中包含的信息很显然是需要传入我在校园打卡的数据。我所在的学校每日打卡需要的数据只有八项，因此抓包得到的body内容也只有这几项。不同的学校可能有所不同，因此各位朋友需要视情况来修改body的信息。
